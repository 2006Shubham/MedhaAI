<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MedhaAi - Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .message { animation: fadeSlideIn 0.3s ease-out; }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .typing {
      width: 30px; height: 12px; background: transparent;
      display: flex; align-items: center; justify-content: space-between;
    }
    .typing span {
      display: block; width: 6px; height: 6px; background: #a855f7;
      border-radius: 50%; animation: blink 1s infinite alternate;
    }
    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      from { opacity: 0.3; transform: translateY(0); }
      to { opacity: 1; transform: translateY(-4px); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-purple-100 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="fixed top-0 left-0 w-full bg-white shadow z-50 flex justify-between items-center px-6 py-4">
    <h1 class="text-2xl font-extrabold text-purple-700">MedhaAi</h1>
    <nav class="hidden md:flex space-x-6">
      <a href="index.html" class="text-gray-700 hover:text-purple-600">Home</a>
      <a href="roadmap.html" class="text-gray-700 hover:text-purple-600">Roadmap</a>
      <a href="chatbot.html" class="text-gray-700 hover:text-purple-600">Chatbot</a>
      <a href="quiz.html" class="text-gray-700 hover:text-purple-600">Interactive Learning</a>
      <a href="#join" class="text-gray-700 hover:text-purple-600">Join Us</a>
    </nav>
    <button id="menu-toggle" class="md:hidden text-purple-700 focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
    <div id="mobile-menu" class="hidden absolute top-full right-0 bg-white shadow-md w-full flex flex-col space-y-4 px-6 py-4 md:hidden">
      <a href="index.html" class="text-gray-700 hover:text-purple-600">Home</a>
      <a href="roadmap.html" class="text-gray-700 hover:text-purple-600">Roadmap</a>
      <a href="chatbot.html" class="text-gray-700 hover:text-purple-600">Chatbot</a>
      <a href="#join" class="text-gray-700 hover:text-purple-600">Join Us</a>
    </div>
  </header>

  <!-- Chatbot -->
  <main class="pt-32 pb-10 flex-grow flex flex-col items-center justify-start px-4">
    <div id="chatbox" class="bg-white w-full max-w-2xl rounded-xl shadow-xl flex flex-col overflow-y-auto p-6 space-y-4 h-[70vh] max-h-[600px]"></div>
    <div class="w-full max-w-2xl flex mt-4">
      <input id="userInput" type="text" placeholder="Ask MedhaAi..."
        class="flex-grow border border-gray-300 rounded-l-full px-4 py-3 focus:outline-purple-500"/>
      <button onclick="sendMessage()"
        class="bg-purple-600 text-white px-6 rounded-r-full font-bold hover:bg-purple-700 transition">Send</button>
    </div>
  </main>

  <footer class="bg-purple-800 text-white text-center py-4">
    <p>&copy; 2025 MedhaAi. All rights reserved.</p>
  </footer>

  <!-- Script -->
  <script>
    const chatbox = document.getElementById("chatbox");
    const userInput = document.getElementById("userInput");

    function appendMessage(text, sender) {
      const wrapper = document.createElement("div");
      wrapper.className = `flex items-start space-x-3 ${sender === "user" ? "justify-end" : "justify-start"}`;
      const avatar = document.createElement("div");
      avatar.className = "w-8 h-8 rounded-full flex items-center justify-center bg-purple-600 text-white font-bold flex-shrink-0";
      avatar.innerText = sender === "user" ? "U" : "A";
      const bubble = document.createElement("div");
      bubble.className = `message max-w-[75%] px-4 py-2 rounded-2xl ${
        sender === "user"
          ? "bg-purple-600 text-white rounded-br-none"
          : "bg-gray-200 text-gray-800 rounded-bl-none"
      }`;
      bubble.innerText = text;

      if (sender === "user") {
        wrapper.appendChild(bubble);
        wrapper.appendChild(avatar);
      } else {
        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
      }

      chatbox.appendChild(wrapper);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function showTyping() {
      const wrapper = document.createElement("div");
      wrapper.id = "typing-indicator";
      wrapper.className = "flex items-start space-x-3 justify-start";
      const avatar = document.createElement("div");
      avatar.className = "w-8 h-8 rounded-full flex items-center justify-center bg-purple-600 text-white font-bold flex-shrink-0";
      avatar.innerText = "A";
      const typing = document.createElement("div");
      typing.className = "typing flex space-x-1";
      typing.innerHTML = "<span></span><span></span><span></span>";
      wrapper.appendChild(avatar);
      wrapper.appendChild(typing);
      chatbox.appendChild(wrapper);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function removeTyping() {
      const typing = document.getElementById("typing-indicator");
      if (typing) typing.remove();
    }

    async function sendMessage() {
      const prompt = userInput.value.trim();
      if (!prompt) return;

      appendMessage(prompt, "user");
      userInput.value = "";
      showTyping();

      const response = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });

      const data = await response.json();
      removeTyping();
      const plainText = cleanMarkdown(data.response || "");
      appendMessage(plainText, "bot");
    }

    userInput.addEventListener("keypress", function(e) {
      if (e.key === "Enter") sendMessage();
    });

    function cleanMarkdown(md) {
      let text = md;
      text = text.replace(/^#{1,6}\s+/gm, '');
      text = text.replace(/\*\*(.*?)\*\*/gs, '$1');
      text = text.replace(/\*(.*?)\*/gs, '$1');
      text = text.replace(/^(-{3,}|_{3,}|\*{3,})$/gm, '');
      text = text.replace(/^\s*([-*+])\s+/gm, '');
      text = text.replace(/^\s*\d+\.\s+/gm, '');
      text = text.replace(/\n{2,}/g, '\n');
      return text.trim();
    }
  </script>
</body>
</html>
